import fig1 from './fig1.png';
import { Image } from 'mdx-deck'

```
Presentasjon1.pptx
Presentasjon-v1.1.pptx
Presentasjon-2.pptx
Presentasjon-2-Final.pptx
Presentasjon-final-final.pptx
```

<Steps>

# Version control

</Steps>

---

```
Presentasjon-1.pptx
Presentasjon-2.pptx
Presentasjon-3.pptx
Presentasjon-4.pptx
Presentasjon-5.pptx
```

<Steps>

# Unified version numbers

</Steps>


---


```
.versions/Presentasjon-1.pptx
.versions/Presentasjon-2.pptx
.versions/Presentasjon-3.pptx
.versions/Presentasjon-4.pptx
.versions/Presentasjon-5.pptx
Presentasjon.pptx
```

<Steps>

# Keep versions in hidden folder

</Steps>


---

<Steps>

# Hashing

Takes a file and turns into a short unique number

Different algoritms like MD5 and SHA256

</Steps>

---

```
.versions/owurnf1241
.versions/few424fw14
.versions/ab321de13d
Presentasjon.pptx
```

<Steps>

This removes duplicates

But now we lose version numbers?

...and file names

</Steps>

---

<Steps>

# Trees

A tree is a text files that map file names to version numbers

```
owurnf1241 Presentasjon.pptx
few424fw14 Presentasjon.pptx
ab321de13d Presentasjon.pptx
```

</Steps>

---


```
.versions/blobs/owurnf1241
.versions/blobs/few424fw14
.versions/blobs/ab321de13d
.version/tree.txt
Presentasjon.pptx
```

<Steps>

But we're still missing version numbers

What hash comes before the other?

And only one tree file?

</Steps>

---


```
.versions/blobs/owurnf1241
.versions/blobs/few424fw14
.versions/blobs/ab321de13d
.versions/trees/1
.versions/trees/2
.versions/trees/3
Presentasjon.pptx
```

<Steps>

What about duplicate trees?

Lets also save trees as hashes!

</Steps>

---

```
.versions/blobs/owurnf1241
.versions/blobs/few424fw14
.versions/blobs/ab321de13d
.versions/trees/be42ade3
.versions/trees/de142ad3
.versions/trees/beade323
Presentasjon.pptx
```

<Steps>

We lost versions numbers

Can we do version numbers better?

</Steps>

---

# Commits

```
Description

Date: 11. Mars 2022
Tree: be42ade3
Previus commit:
```


<Steps>

A commit is a "linked list" where each commit points to:

- The hash of a tree

- The hash of the previus commit

</Steps>

---

# Commits

<Image src={fig1} style={{
	display: 'flex',
	'background-size': 'contain',
	alignItems: 'center',
	justifyContent: 'center',
	color: 'white',
	backgroundColor: 'black',
	}} />

---

Git uses a folder called `.git` not `.versions` like in our example


```
.git/blobs/owurnf1241
.git/blobs/few424fw14
.git/blobs/ab321de13d
.git/trees/be42ade3
.git/trees/de142ad3
.git/trees/beade323
.git/commits/eb23ae3
.git/commits/bede123
Presentasjon.pptx
```

---

They also keeps all `blobs`, `trees` and `commits` in one folder.


```
.git/objects/owurnf1241
.git/objects/few424fw14
.git/objects/ab321de13d
.git/objects/be42ade3
.git/objects/de142ad3
.git/objects/beade323
.git/objects/eb23ae3
.git/objects/bede123
Presentasjon.pptx
```

<Steps>

But wait, how do we find the newest commit?

</Steps>

---

At last

# Branches

<Steps>

A branch have two parts:

- A name

- The hash of the newest commit

Thats it.

</Steps>

---


```
.git/objects/owurnf1241
.git/objects/few424fw14
.git/objects/ab321de13d
.git/objects/be42ade3
.git/objects/de142ad3
.git/objects/beade323
.git/objects/eb23ae3
.git/objects/bede123

.git/refs/heads/main

Presentasjon.pptx
```

<Steps>

Branches is internally called `refs` in Git.

And now we just need one more thing

</Steps>

---


```
.git/objects/ab/urnf1241
.git/objects/ab/w424fw14
.git/objects/ba/321de13d
.git/objects/ba/42ade3ba
.git/objects/de/142ad3ac
.git/objects/de/ade323bf
.git/objects/ef/23ae3aff
.git/objects/ef/de123aff
.git/refs/heads/main
Presentasjon.pptx
```

<Steps>

To many files is problems. So we group them in folders

And now we have reinvented Git!

</Steps>

---

<span>
	<a href="https://github.com/theknarf-talks/presentation-2022-git-internals" style={{ color: 'white' }}>
	github.com/theknarf-talks/presentation-2022-git-internals
	</a>
</span>
